<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA DATA 2024-25 å‰100åçƒå“¡æ•¸æ“šå„€è¡¨æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        h1 {
            text-align: center;
            font-size: 2.8em;
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .subtitle {
            text-align: center;
            color: #666;
            font-size: 1.1em;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
        }

        input[type="text"] {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s;
            background: white;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #2a5298;
            box-shadow: 0 0 0 3px rgba(42, 82, 152, 0.1);
        }

        .search-icon {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 18px;
        }

        select {
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 25px;
            font-size: 16px;
            background: white;
            cursor: pointer;
            min-width: 150px;
        }

        button {
            background: linear-gradient(45deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(42, 82, 152, 0.3);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .player-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
            height: 350px;
            cursor: pointer;
            perspective: 1000px;
        }

        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .player-card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            justify-content: center;
            align-items: center;
        }

        .card-back {
            background: rgba(255, 255, 255, 0.95);
            transform: rotateY(180deg);
            overflow-y: auto;
        }

        .player-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 20px;
            object-fit: cover;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3em;
        }

        .card-front .player-name {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .card-front .player-team {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .card-front .hoopshype-rank {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
            backdrop-filter: blur(10px);
        }

        .flip-hint {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8em;
            opacity: 0.7;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        .ranking-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            z-index: 10;
        }

        .top-10 {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #333;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.5);
        }

        .top-25 {
            background: linear-gradient(45deg, #c0c0c0, #e8e8e8);
            color: #333;
            box-shadow: 0 4px 15px rgba(192, 192, 192, 0.5);
        }

        .top-50 {
            background: linear-gradient(45deg, #cd7f32, #deb887);
            color: white;
            box-shadow: 0 4px 15px rgba(205, 127, 50, 0.5);
        }

        .card-back .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .card-back .player-name {
            font-size: 1.4em;
            font-weight: bold;
            color: #1e3c72;
        }

        .card-back .player-position {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .player-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
        }

        .info-label {
            color: #666;
            font-size: 0.9em;
        }

        .info-value {
            font-weight: bold;
            color: #333;
        }

        .advanced-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 10px;
        }

        .stat-value {
            font-size: 1.2em;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .stat-name {
            font-size: 0.8em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .placeholder-card {
            opacity: 0.7;
            border: 2px dashed #ccc;
        }

        .placeholder-card .card-front {
            background: #ccc;
        }

        .placeholder-content {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .loading-spinner {
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #ff6b6b;
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .no-results {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 30px 0;
        }

        .page-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #1e3c72;
            border: 2px solid #1e3c72;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 40px;
            text-align: center;
        }

        .page-btn:hover, .page-btn.active {
            background: #1e3c72;
            color: white;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .players-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .advanced-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>ğŸ€ NBA data 2024-25 å‰100åçƒå“¡</h1>
            <p class="subtitle">
                NBAçƒå“¡å®Œæ•´çµ±è¨ˆæ•¸æ“š
            </p>
            
            <div class="controls">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="æœå°‹çƒå“¡å§“å...">
                    <span class="search-icon">ğŸ”</span>
                </div>
                
                <select id="teamFilter">
                    <option value="">æ‰€æœ‰çƒéšŠ</option>
                </select>
                
                <select id="rankFilter">
                    <option value="">æ‰€æœ‰æ’å</option>
                    <option value="1-10">å‰10å</option>
                    <option value="11-25">11-25å</option>
                    <option value="26-50">26-50å</option>
                    <option value="51-100">51-100å</option>
                </select>
                
                <select id="dataTypeSelect">
                    <option value="advanced">é€²éšçµ±è¨ˆ</option>
                    <option value="totals">åŸºæœ¬çµ±è¨ˆ</option>
                </select>
                
                <button onclick="loadPlayers()">è¼‰å…¥æ•¸æ“š</button>
                <button onclick="clearFilters()">æ¸…é™¤ç¯©é¸</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="stats-summary" id="statsSummary" style="display: none;">
            <div class="stat-card">
                <div class="stat-number" id="totalPlayers">0</div>
                <div class="stat-label">TOP 100 çƒå“¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgAge">0</div>
                <div class="stat-label">å¹³å‡å¹´é½¡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalTeams">0</div>
                <div class="stat-label">çƒéšŠæ•¸é‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgPER">0</div>
                <div class="stat-label">å¹³å‡PER</div>
            </div>
        </div>

        <div id="loadingDiv" class="loading" style="display: none;">
            <div class="loading-spinner"></div>
            æ­£åœ¨è¼‰å…¥NBAå‰100åçƒå“¡æ•¸æ“š...
        </div>

        <div id="errorDiv" class="error" style="display: none;"></div>

        <div class="pagination" id="pagination" style="display: none;"></div>

        <div class="players-grid" id="playersContainer"></div>

        <div class="pagination" id="paginationBottom" style="display: none;"></div>
    </div>

    <script>
        // HoopsHype 2024-25 å‰100åçƒå“¡åå–® (åŒ…å«APIåç¨±æ˜ å°„)
        const top100Players = [
            "Nikola Jokic", "Luka Doncic", "Shai Gilgeous-Alexander", "Giannis Antetokounmpo", "Joel Embiid",
            "Jayson Tatum", "Anthony Edwards", "Jalen Brunson", "Anthony Davis", "Victor Wembanyama",
            "Kevin Durant", "Tyrese Haliburton", "LeBron James", "Stephen Curry", "Tyrese Maxey",
            "Devin Booker", "Donovan Mitchell", "Jaylen Brown", "Ja Morant", "Domantas Sabonis",
            "Damian Lillard", "Zion Williamson", "Paolo Banchero", "De'Aaron Fox", "Pascal Siakam",
            "Kawhi Leonard", "Paul George", "Bam Adebayo", "Trae Young", "Jimmy Butler",
            "Karl-Anthony Towns", "Rudy Gobert", "Kyrie Irving", "Lauri Markkanen", "Scottie Barnes",
            "Jamal Murray", "Cade Cunningham", "Julius Randle", "Alperen Sengun", "Chet Holmgren",
            "LaMelo Ball", "Jaren Jackson Jr", "Jalen Williams", "Kristaps Porzingis", "DeMar DeRozan",
            "Brandon Ingram", "James Harden", "Franz Wagner", "Desmond Bane", "Derrick White",
            "Evan Mobley", "Darius Garland", "Myles Turner", "Jrue Holiday", "Dejounte Murray",
            "Mikal Bridges", "OG Anunoby", "Brandon Miller", "Aaron Gordon", "Jarrett Allen",
            "Kyle Kuzma", "Zach LaVine", "Austin Reaves", "Michael Porter Jr", "Jalen Green",
            "Fred VanVleet", "Miles Bridges", "Jalen Johnson", "Tyler Herro", "Coby White",
            "CJ McCollum", "Josh Giddey", "Bradley Beal", "Trey Murphy", "D'Angelo Russell",
            "Devin Vassell", "Immanuel Quickley", "Herb Jones", "Jaden McDaniels", "Jerami Grant",
            "Josh Hart", "Keegan Murray", "Jonathan Kuminga", "Malik Monk", "Cam Thomas",
            "Donte DiVincenzo", "Anfernee Simons", "Jabari Smith Jr", "Nikola Vucevic", "Tobias Harris",
            "Naz Reid", "Luguentz Dort", "Jalen Suggs", "PJ Washington", "RJ Barrett",
            "Khris Middleton", "Deandre Ayton", "Collin Sexton", "Dereck Lively", "Klay Thompson"
        ];

        // çƒå“¡ç…§ç‰‡æ˜ å°„è¡¨ - å®Œæ•´çš„100åçƒå“¡ç…§ç‰‡è·¯å¾‘
        const playerPhotoMappings = {
            // å‰10å (è¶…ç´šå·¨æ˜Ÿ)
            "Nikola Jokic": "photos/nikola-jokic.jpg",
            "Luka Doncic": "photos/luka-doncic.jpg", 
            "Shai Gilgeous-Alexander": "photos/shai-gilgeous-alexander.jpg",
            "Giannis Antetokounmpo": "photos/giannis-antetokounmpo.jpg",
            "Joel Embiid": "photos/joel-embiid.jpg",
            "Jayson Tatum": "photos/jayson-tatum.jpg",
            "Anthony Edwards": "photos/anthony-edwards.jpg",
            "Jalen Brunson": "photos/jalen-brunson.jpg",
            "Anthony Davis": "photos/anthony-davis.jpg",
            "Victor Wembanyama": "photos/victor-wembanyama.jpg",
            
            // 11-25å (All-Starç´šåˆ¥)
            "Kevin Durant": "photos/kevin-durant.jpg",
            "Tyrese Haliburton": "photos/tyrese-haliburton.jpg",
            "LeBron James": "photos/lebron-james.jpg",
            "Stephen Curry": "photos/stephen-curry.jpg",
            "Tyrese Maxey": "photos/tyrese-maxey.jpg",
            "Devin Booker": "photos/devin-booker.jpg",
            "Donovan Mitchell": "photos/donovan-mitchell.jpg",
            "Jaylen Brown": "photos/jaylen-brown.jpg",
            "Ja Morant": "photos/ja-morant.jpg",
            "Domantas Sabonis": "photos/domantas-sabonis.jpg",
            "Damian Lillard": "photos/damian-lillard.jpg",
            "Zion Williamson": "photos/zion-williamson.jpg",
            "Paolo Banchero": "photos/paolo-banchero.jpg",
            "De'Aaron Fox": "photos/deaaron-fox.jpg",
            "Pascal Siakam": "photos/pascal-siakam.jpg",
            
            // 26-50å (æ˜æ˜Ÿçƒå“¡)
            "Kawhi Leonard": "photos/kawhi-leonard.jpg",
            "Paul George": "photos/paul-george.jpg",
            "Bam Adebayo": "photos/bam-adebayo.jpg",
            "Trae Young": "photos/trae-young.jpg",
            "Jimmy Butler": "photos/jimmy-butler.jpg",
            "Karl-Anthony Towns": "photos/karl-anthony-towns.jpg",
            "Rudy Gobert": "photos/rudy-gobert.jpg",
            "Kyrie Irving": "photos/kyrie-irving.jpg",
            "Lauri Markkanen": "photos/lauri-markkanen.jpg",
            "Scottie Barnes": "photos/scottie-barnes.jpg",
            "Jamal Murray": "photos/jamal-murray.jpg",
            "Cade Cunningham": "photos/cade-cunningham.jpg",
            "Julius Randle": "photos/julius-randle.jpg",
            "Alperen Sengun": "photos/alperen-sengun.jpg",
            "Chet Holmgren": "photos/chet-holmgren.jpg",
            "LaMelo Ball": "photos/lamelo-ball.jpg",
            "Jaren Jackson Jr": "photos/jaren-jackson-jr.jpg",
            "Jalen Williams": "photos/jalen-williams.jpg",
            "Kristaps Porzingis": "photos/kristaps-porzingis.jpg",
            "DeMar DeRozan": "photos/demar-derozan.jpg",
            "Brandon Ingram": "photos/brandon-ingram.jpg",
            "James Harden": "photos/james-harden.jpg",
            "Franz Wagner": "photos/franz-wagner.jpg",
            "Desmond Bane": "photos/desmond-bane.jpg",
            "Derrick White": "photos/derrick-white.jpg",
            
            // 51-75å (å„ªè³ªå…ˆç™¼)
            "Evan Mobley": "photos/evan-mobley.jpg",
            "Darius Garland": "photos/darius-garland.jpg",
            "Myles Turner": "photos/myles-turner.jpg",
            "Jrue Holiday": "photos/jrue-holiday.jpg",
            "Dejounte Murray": "photos/dejounte-murray.jpg",
            "Mikal Bridges": "photos/mikal-bridges.jpg",
            "OG Anunoby": "photos/og-anunoby.jpg",
            "Brandon Miller": "photos/brandon-miller.jpg",
            "Aaron Gordon": "photos/aaron-gordon.jpg",
            "Jarrett Allen": "photos/jarrett-allen.jpg",
            "Kyle Kuzma": "photos/kyle-kuzma.jpg",
            "Zach LaVine": "photos/zach-lavine.jpg",
            "Austin Reaves": "photos/austin-reaves.jpg",
            "Michael Porter Jr": "photos/michael-porter-jr.jpg",
            "Jalen Green": "photos/jalen-green.jpg",
            "Fred VanVleet": "photos/fred-vanvleet.jpg",
            "Miles Bridges": "photos/miles-bridges.jpg",
            "Jalen Johnson": "photos/jalen-johnson.jpg",
            "Tyler Herro": "photos/tyler-herro.jpg",
            "Coby White": "photos/coby-white.jpg",
            "CJ McCollum": "photos/cj-mccollum.jpg",
            "Josh Giddey": "photos/josh-giddey.jpg",
            "Bradley Beal": "photos/bradley-beal.jpg",
            "Trey Murphy": "photos/trey-murphy.jpg",
            "D'Angelo Russell": "photos/dangelo-russell.jpg",
            
            // 76-100å (å¯¦åŠ›è§’è‰²çƒå“¡)
            "Devin Vassell": "photos/devin-vassell.jpg",
            "Immanuel Quickley": "photos/immanuel-quickley.jpg",
            "Herb Jones": "photos/herb-jones.jpg",
            "Jaden McDaniels": "photos/jaden-mcdaniels.jpg",
            "Jerami Grant": "photos/jerami-grant.jpg",
            "Josh Hart": "photos/josh-hart.jpg",
            "Keegan Murray": "photos/keegan-murray.jpg",
            "Jonathan Kuminga": "photos/jonathan-kuminga.jpg",
            "Malik Monk": "photos/malik-monk.jpg",
            "Cam Thomas": "photos/cam-thomas.jpg",
            "Donte DiVincenzo": "photos/donte-divincenzo.jpg",
            "Anfernee Simons": "photos/anfernee-simons.jpg",
            "Jabari Smith Jr": "photos/jabari-smith-jr.jpg",
            "Nikola Vucevic": "photos/nikola-vucevic.jpg",
            "Tobias Harris": "photos/tobias-harris.jpg",
            "Naz Reid": "photos/naz-reid.jpg",
            "Luguentz Dort": "photos/luguentz-dort.jpg",
            "Jalen Suggs": "photos/jalen-suggs.jpg",
            "PJ Washington": "photos/pj-washington.jpg",
            "RJ Barrett": "photos/rj-barrett.jpg",
            "Khris Middleton": "photos/khris-middleton.jpg",
            "Deandre Ayton": "photos/deandre-ayton.jpg",
            "Collin Sexton": "photos/collin-sexton.jpg",
            "Dereck Lively": "photos/dereck-lively.jpg",
            "Klay Thompson": "photos/klay-thompson.jpg"
        };

        // æ‰¹é‡è«‹æ±‚é…ç½®
        const BATCH_SIZE = 10; // æ¯æ‰¹è™•ç†çš„çƒå“¡æ•¸é‡
        const REQUEST_DELAY = 50; // è«‹æ±‚é–“éš”(æ¯«ç§’)ï¼Œæ¸›å°‘åˆ°50ms
        const MAX_CONCURRENT = 5; // æœ€å¤§ä½µç™¼è«‹æ±‚æ•¸

        // çƒå“¡å§“åAPIæ˜ å°„è¡¨ - è™•ç†ç‰¹æ®Šæƒ…æ³
        const playerNameMappings = {
            "Nikola Jokic": ["Nikola Jokic", "Nikola JokiÄ‡"],
            "Luka Doncic": ["Luka Doncic", "Luka DonÄiÄ‡", "Luka DonÄic"],
            "Kristaps Porzingis": ["Kristaps Porzingis", "Kristaps PorziÅ†Ä£is", "Kristaps Porzinigis"],
            "Herb Jones": ["Herb Jones", "Herbert Jones", "Herbert Keyshawn Jones"],
            "Nikola Vucevic": ["Nikola Vucevic", "Nikola VuÄeviÄ‡", "Nikola Vucevic"],
            "PJ Washington": ["PJ Washington", "P.J. Washington", "Paul Jamaine Washington"],
            "RJ Barrett": ["RJ Barrett", "R.J. Barrett", "Rowan Barrett Jr."],
            "CJ McCollum": ["CJ McCollum", "C.J. McCollum", "Christian James McCollum"],
            "OG Anunoby": ["OG Anunoby", "O.G. Anunoby", "Ogugua Anunoby"],
            "Alperen Sengun": ["Alperen Sengun", "Alperen ÅengÃ¼n"],
            "Jaren Jackson Jr": ["Jaren Jackson Jr", "Jaren Jackson Jr.", "Jaren Walter Jackson Jr."],
            "Karl-Anthony Towns": ["Karl-Anthony Towns", "Karl Anthony Towns"]
        };

        let allPlayers = [];
        let filteredPlayers = [];
        let currentPage = 1;
        const playersPerPage = 12;
        let currentDataType = 'advanced';

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = function() {
            populateFilters();
            loadPlayers();
        };

        // è¼‰å…¥çƒå“¡æ•¸æ“š
        async function loadPlayers() {
            const loadingDiv = document.getElementById('loadingDiv');
            const errorDiv = document.getElementById('errorDiv');
            const playersContainer = document.getElementById('playersContainer');
            const statsSummary = document.getElementById('statsSummary');
            
            loadingDiv.style.display = 'block';
            errorDiv.style.display = 'none';
            playersContainer.innerHTML = '';
            statsSummary.style.display = 'none';
            
            currentDataType = document.getElementById('dataTypeSelect').value;
            const endpoint = currentDataType === 'advanced' ? 'PlayerDataAdvanced' : 'PlayerDataTotals';
            
            try {
                // ç›´æ¥ä½¿ç”¨é€å€‹è¼‰å…¥æ–¹å¼ï¼Œå› ç‚ºqueryç«¯é»çš„æ•¸æ“šä¸å®Œæ•´
                console.log('ä½¿ç”¨é€å€‹è¼‰å…¥æ–¹å¼ç²å–çƒå“¡æ•¸æ“š...');
                await loadPlayersIndividually(endpoint);
                
            } catch (error) {
                console.error('è¼‰å…¥çƒå“¡æ•¸æ“šæ™‚å‡ºéŒ¯:', error);
                loadingDiv.style.display = 'none';
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <h3>è¼‰å…¥æ•¸æ“šæ™‚ç™¼ç”ŸéŒ¯èª¤</h3>
                    <p>${error.message}</p>
                    <p>å¯èƒ½çš„åŸå› ï¼š</p>
                    <ul style="text-align: left; margin-top: 10px;">
                        <li>APIæœå‹™å™¨æš«æ™‚ç„¡æ³•è¨ªå•</li>
                        <li>ç¶²è·¯é€£æ¥å•é¡Œ</li>
                        <li>CORSæ”¿ç­–é™åˆ¶</li>
                    </ul>
                    <button onclick="loadPlayers()" style="margin-top: 15px; background: white; color: #ff6b6b; border: 2px solid white;">é‡æ–°è¼‰å…¥</button>
                `;
            }
        }

        // é«˜é€Ÿæ‰¹é‡è¼‰å…¥çƒå“¡æ•¸æ“š
        async function loadPlayersIndividually(endpoint) {
            const loadingDiv = document.getElementById('loadingDiv');
            const errorDiv = document.getElementById('errorDiv');
            
            allPlayers = [];
            let successCount = 0;
            let errorCount = 0;
            let currentBatch = 0;
            
            // åˆ†æ‰¹æ¬¡è™•ç†ï¼Œæ¯æ‰¹ä½µç™¼è«‹æ±‚
            const totalBatches = Math.ceil(top100Players.length / BATCH_SIZE);
            
            for (let batchIndex = 0; batchIndex < totalBatches; batchIndex++) {
                const startIndex = batchIndex * BATCH_SIZE;
                const endIndex = Math.min(startIndex + BATCH_SIZE, top100Players.length);
                const batch = top100Players.slice(startIndex, endIndex);
                
                // æ›´æ–°é€²åº¦
                const progress = ((batchIndex + 1) / totalBatches * 100);
                loadingDiv.innerHTML = `
                    <div class="loading-spinner"></div>
                    ğŸš€ é«˜é€Ÿè¼‰å…¥ä¸­... ${progress.toFixed(0)}%
                    <br>æ­£åœ¨è™•ç†ç¬¬ ${batchIndex + 1}/${totalBatches} æ‰¹ (${batch.length} ä½çƒå“¡)
                    <br><small>å·²æˆåŠŸ: ${successCount} | å¤±æ•—: ${errorCount}</small>
                `;
                
                // ä½µç™¼è™•ç†ç•¶å‰æ‰¹æ¬¡
                const batchPromises = batch.map(async (playerName, batchPlayerIndex) => {
                    const playerIndex = startIndex + batchPlayerIndex;
                    return await loadSinglePlayer(playerName, playerIndex, endpoint);
                });
                
                // ç­‰å¾…ç•¶å‰æ‰¹æ¬¡å®Œæˆ
                const batchResults = await Promise.allSettled(batchPromises);
                
                // çµ±è¨ˆçµæœ
                batchResults.forEach((result, batchPlayerIndex) => {
                    const playerIndex = startIndex + batchPlayerIndex;
                    if (result.status === 'fulfilled' && result.value) {
                        allPlayers.push(result.value);
                        successCount++;
                    } else {
                        // å‰µå»ºä½”ä½ç¬¦
                        const placeholder = {
                            playerName: top100Players[playerIndex],
                            team: 'N/A',
                            position: 'N/A',
                            age: 0,
                            season: 2024,
                            hoopsHypeRank: playerIndex + 1,
                            originalName: top100Players[playerIndex],
                            isPlaceholder: true
                        };
                        allPlayers.push(placeholder);
                        errorCount++;
                    }
                });
                
                // å¯¦æ™‚æ›´æ–°é¡¯ç¤º
                if (batchIndex % 2 === 0 || batchIndex === totalBatches - 1) {
                    allPlayers.sort((a, b) => a.hoopsHypeRank - b.hoopsHypeRank);
                    updateFilterOptions();
                    applyFilters();
                    updateStatsSummary();
                    document.getElementById('statsSummary').style.display = 'grid';
                }
                
                // å°å»¶é²é¿å…APIé™åˆ¶
                if (batchIndex < totalBatches - 1) {
                    await new Promise(resolve => setTimeout(resolve, REQUEST_DELAY));
                }
            }
            
            console.log(`ğŸ¯ è¼‰å…¥å®Œæˆ: æˆåŠŸ ${successCount}/100 ä½çƒå“¡ (${(successCount/100*100).toFixed(1)}%)`);
            
            // æœ€çµ‚æ•´ç†å’Œé¡¯ç¤º
            allPlayers.sort((a, b) => a.hoopsHypeRank - b.hoopsHypeRank);
            updateFilterOptions();
            applyFilters();
            updateStatsSummary();
            
            loadingDiv.style.display = 'none';
            document.getElementById('statsSummary').style.display = 'grid';
            
            // é¡¯ç¤ºçµæœçµ±è¨ˆ
            if (errorCount > 0) {
                errorDiv.style.display = 'block';
                errorDiv.innerHTML = `
                    <h3>ğŸ¯ è¼‰å…¥å®Œæˆï¼</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 15px 0;">
                        <div style="text-align: center; padding: 10px; background: #d4edda; border-radius: 10px;">
                            <div style="font-size: 2em; font-weight: bold; color: #155724;">${successCount}</div>
                            <div style="color: #155724;">æˆåŠŸè¼‰å…¥</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #f8d7da; border-radius: 10px;">
                            <div style="font-size: 2em; font-weight: bold; color: #721c24;">${errorCount}</div>
                            <div style="color: #721c24;">è¼‰å…¥å¤±æ•—</div>
                        </div>
                        <div style="text-align: center; padding: 10px; background: #d1ecf1; border-radius: 10px;">
                            <div style="font-size: 2em; font-weight: bold; color: #0c5460;">${(successCount/100*100).toFixed(1)}%</div>
                            <div style="color: #0c5460;">æˆåŠŸç‡</div>
                        </div>
                    </div>
                    <small>âš¡ ä½¿ç”¨é«˜é€Ÿä¸¦ç™¼è¼‰å…¥æŠ€è¡“</small>
                `;
            }
        }

        // è¼‰å…¥å–®å€‹çƒå“¡æ•¸æ“š
        async function loadSinglePlayer(playerName, playerIndex, endpoint) {
            try {
                const nameVariants = playerNameMappings[playerName] || [playerName];
                
                for (const variant of nameVariants) {
                    const encodedName = encodeURIComponent(variant);
                    const response = await fetch(`http://rest.nbaapi.com/api/${endpoint}/name/${encodedName}`);
                    
                    if (response.ok) {
                        const playerData = await response.json();
                        if (Array.isArray(playerData) && playerData.length > 0) {
                            const latestData = playerData.sort((a, b) => b.season - a.season)[0];
                            latestData.hoopsHypeRank = playerIndex + 1;
                            latestData.originalName = playerName;
                            latestData.apiName = variant;
                            
                            console.log(`âœ… ${playerIndex + 1}/100: ${playerName}`);
                            return latestData;
                        }
                    }
                }
                
                console.warn(`âŒ ${playerIndex + 1}/100: ${playerName} - æœªæ‰¾åˆ°`);
                return null;
            } catch (error) {
                console.error(`ğŸ’¥ ${playerIndex + 1}/100: ${playerName} - éŒ¯èª¤: ${error.message}`);
                return null;
            }
        }

        // æ›´æ–°ç¯©é¸å™¨é¸é …
        function updateFilterOptions() {
            const teamFilter = document.getElementById('teamFilter');
            
            // ç²å–å”¯ä¸€çš„çƒéšŠ
            const teams = [...new Set(allPlayers.map(p => p.team))].sort();
            teamFilter.innerHTML = '<option value="">æ‰€æœ‰çƒéšŠ</option>' + 
                teams.map(team => `<option value="${team}">${team}</option>`).join('');
        }

        // é è¨­å¡«å……ç¯©é¸å™¨
        function populateFilters() {
            const teamFilter = document.getElementById('teamFilter');
            
            // å¸¸è¦‹NBAçƒéšŠ
            const commonTeams = ['LAL', 'GSW', 'BOS', 'MIA', 'CHI', 'NYK', 'LAC', 'PHX', 'DAL', 'MIL'];
            teamFilter.innerHTML = '<option value="">æ‰€æœ‰çƒéšŠ</option>' + 
                commonTeams.map(team => `<option value="${team}">${team}</option>`).join('');
        }

        // æ‡‰ç”¨ç¯©é¸
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const teamFilter = document.getElementById('teamFilter').value;
            const rankFilter = document.getElementById('rankFilter').value;
            
            filteredPlayers = allPlayers.filter(player => {
                const matchesSearch = !searchTerm || 
                    player.playerName.toLowerCase().includes(searchTerm);
                const matchesTeam = !teamFilter || player.team === teamFilter;
                
                let matchesRank = true;
                if (rankFilter) {
                    const [min, max] = rankFilter.split('-').map(Number);
                    matchesRank = player.hoopsHypeRank >= min && player.hoopsHypeRank <= max;
                }
                
                return matchesSearch && matchesTeam && matchesRank;
            });
            
            currentPage = 1;
            displayPlayers();
        }

        // é¡¯ç¤ºçƒå“¡
        function displayPlayers() {
            const playersContainer = document.getElementById('playersContainer');
            const startIndex = (currentPage - 1) * playersPerPage;
            const endIndex = startIndex + playersPerPage;
            const playersToShow = filteredPlayers.slice(startIndex, endIndex);
            
            if (playersToShow.length === 0) {
                playersContainer.innerHTML = '<div class="no-results">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„çƒå“¡</div>';
                document.getElementById('pagination').style.display = 'none';
                document.getElementById('paginationBottom').style.display = 'none';
                return;
            }
            
            playersContainer.innerHTML = playersToShow.map(player => createPlayerCard(player)).join('');
            updatePagination();
        }

        // å‰µå»ºçƒå“¡å¡ç‰‡
        function createPlayerCard(player) {
            const isAdvanced = currentDataType === 'advanced';
            const rank = player.hoopsHypeRank;
            
            let rankClass = '';
            if (rank <= 10) rankClass = 'top-10';
            else if (rank <= 25) rankClass = 'top-25';
            else if (rank <= 50) rankClass = 'top-50';
            
            // è™•ç†ä½”ä½ç¬¦æ•¸æ“š
            if (player.isPlaceholder) {
                return `
                    <div class="player-card placeholder-card" onclick="flipCard(this)">
                        <div class="ranking-badge ${rankClass}">#${rank}</div>
                        <div class="card-inner">
                            <!-- æ­£é¢ -->
                            <div class="card-front">
                                <div class="player-photo">â“</div>
                                <div class="player-name">${player.playerName}</div>
                                <div class="player-team">æ•¸æ“šä¸å¯ç”¨</div>
                                <div class="hoopshype-rank">HoopsHype #${rank}</div>
                                <div class="flip-hint">é»æ“Šç¿»è½‰å¡ç‰‡</div>
                            </div>
                            <!-- èƒŒé¢ -->
                            <div class="card-back">
                                <div class="placeholder-content">
                                    <h3>âš ï¸ æ•¸æ“šè¼‰å…¥å¤±æ•—</h3>
                                    <p>ç„¡æ³•å¾APIç²å–æ­¤çƒå“¡çš„æ•¸æ“š</p>
                                    <p>å¯èƒ½å› ç‚ºå§“åæ ¼å¼å·®ç•°å°è‡´</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // ç”Ÿæˆçƒå“¡ç…§ç‰‡URLï¼ˆä½¿ç”¨NBA Headshots APIæˆ–ä½”ä½ç¬¦ï¼‰
            const playerPhotoUrl = getPlayerPhotoUrl(player.playerName);
            
            return `
                <div class="player-card" onclick="flipCard(this)">
                    <div class="ranking-badge ${rankClass}">#${rank}</div>
                    <div class="card-inner">
                        <!-- æ­£é¢ -->
                        <div class="card-front">
                            <div class="player-photo">
                                ${playerPhotoUrl ? 
                                    `<img src="${playerPhotoUrl}" alt="${player.playerName}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" onerror="handlePhotoError(this)">
                                     <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; font-size: 3em; background: rgba(255,255,255,0.1); border-radius: 50%;">ğŸ€</div>` 
                                    : '<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 3em; background: rgba(255,255,255,0.1); border-radius: 50%;">ğŸ€</div>'
                                }
                            </div>
                            <div class="player-name">${player.playerName}</div>
                            <div class="player-team">${player.team}</div>
                            <div class="hoopshype-rank">RANK #${rank}</div>
                            <div class="flip-hint">é»æ“ŠæŸ¥çœ‹æ•¸æ“š â†»</div>
                        </div>
                        
                        <!-- èƒŒé¢ -->
                        <div class="card-back">
                            <div class="player-header">
                                <div class="player-name">${player.playerName}</div>
                                <div class="player-position">${player.position || 'N/A'}</div>
                            </div>
                            
                            <div class="player-info">
                                <div class="info-item">
                                    <span class="info-label">çƒéšŠ:</span>
                                    <span class="info-value">${player.team}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">NBAæ’å:</span>
                                    <span class="info-value">#${rank}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">è³½å­£:</span>
                                    <span class="info-value">${player.season}-${(player.season + 1).toString().slice(-2)}</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">å¹´é½¡:</span>
                                    <span class="info-value">${player.age || 'N/A'}</span>
                                </div>
                            </div>
                            
                            <div class="advanced-stats">
                                ${isAdvanced ? `
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.per || 0).toFixed(1)}</div>
                                        <div class="stat-name">PER</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${((player.tsPercent || 0) * 100).toFixed(1)}%</div>
                                        <div class="stat-name">TS%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.usagePercent || 0).toFixed(1)}%</div>
                                        <div class="stat-name">USG%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.winShares || 0).toFixed(1)}</div>
                                        <div class="stat-name">WS</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.vorp || 0).toFixed(1)}</div>
                                        <div class="stat-name">VORP</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${(player.box || 0).toFixed(1)}</div>
                                        <div class="stat-name">BPM</div>
                                    </div>
                                ` : `
                                    <div class="stat-item">
                                        <div class="stat-value">${player.points || 0}</div>
                                        <div class="stat-name">å¾—åˆ†</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${player.assists || 0}</div>
                                        <div class="stat-name">åŠ©æ”»</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${player.totalRb || player.rebounds || 0}</div>
                                        <div class="stat-name">ç±ƒæ¿</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${((player.fieldPercent || 0) * 100).toFixed(1)}%</div>
                                        <div class="stat-name">æŠ•ç±ƒ%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${((player.threePercent || 0) * 100).toFixed(1)}%</div>
                                        <div class="stat-name">ä¸‰åˆ†%</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value">${player.steals || 0}</div>
                                        <div class="stat-name">æŠ„æˆª</div>
                                    </div>
                                `}
                            </div>
                            
                            <div class="flip-hint" style="margin-top: 15px;">é»æ“Šè¿”å›ç…§ç‰‡ â†»</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ç²å–çƒå“¡ç…§ç‰‡URL
        function getPlayerPhotoUrl(playerName) {
            // å„ªå…ˆä½¿ç”¨æœ¬åœ°ç…§ç‰‡æ˜ å°„
            if (playerPhotoMappings[playerName]) {
                return playerPhotoMappings[playerName];
            }
            
            // è‡ªå‹•ç”Ÿæˆæ–‡ä»¶åæ ¼å¼ï¼ˆä½œç‚ºå‚™ç”¨ï¼‰
            try {
                const formattedName = playerName.toLowerCase()
                    .replace(/[^a-z\s]/g, '')
                    .replace(/\s+/g, '-');
                
                // å˜—è©¦å¸¸è¦‹çš„æ–‡ä»¶æ ¼å¼
                const possiblePaths = [
                    `photos/${formattedName}.jpg`,
                    `photos/${formattedName}.png`,
                    `images/${formattedName}.jpg`,
                    `assets/players/${formattedName}.jpg`
                ];
                
                // è¿”å›ç¬¬ä¸€å€‹å¯èƒ½çš„è·¯å¾‘ï¼ˆå¯ä»¥å¾ŒçºŒæ·»åŠ å­˜åœ¨æ€§æª¢æŸ¥ï¼‰
                return possiblePaths[0];
            } catch (error) {
                return null;
            }
        }

        // æª¢æŸ¥ç…§ç‰‡æ˜¯å¦å­˜åœ¨ä¸¦è™•ç†éŒ¯èª¤
        function handlePhotoError(imgElement) {
            // ç…§ç‰‡è¼‰å…¥å¤±æ•—æ™‚çš„è™•ç†
            imgElement.style.display = 'none';
            const fallbackDiv = imgElement.nextElementSibling;
            if (fallbackDiv) {
                fallbackDiv.style.display = 'flex';
            }
        }

        // å¡ç‰‡ç¿»è½‰åŠŸèƒ½
        function flipCard(cardElement) {
            cardElement.classList.toggle('flipped');
        }

        // æ›´æ–°çµ±è¨ˆæ‘˜è¦
        function updateStatsSummary() {
            if (filteredPlayers.length === 0) return;
            
            const totalPlayers = filteredPlayers.length;
            const avgAge = (filteredPlayers.reduce((sum, p) => sum + (p.age || 0), 0) / totalPlayers).toFixed(1);
            const totalTeams = new Set(filteredPlayers.map(p => p.team)).size;
            
            let avgPER = 0;
            if (currentDataType === 'advanced') {
                avgPER = (filteredPlayers.reduce((sum, p) => sum + (p.per || 0), 0) / totalPlayers).toFixed(1);
            } else {
                avgPER = (filteredPlayers.reduce((sum, p) => sum + (p.points || 0), 0) / totalPlayers).toFixed(1);
            }
            
            document.getElementById('totalPlayers').textContent = totalPlayers;
            document.getElementById('avgAge').textContent = avgAge;
            document.getElementById('totalTeams').textContent = totalTeams;
            document.getElementById('avgPER').textContent = avgPER;
            
            // æ›´æ–°æ¨™ç±¤
            const perLabel = document.querySelector('#statsSummary .stat-card:last-child .stat-label');
            perLabel.textContent = currentDataType === 'advanced' ? 'å¹³å‡PER' : 'å¹³å‡å¾—åˆ†';
        }

        // æ›´æ–°åˆ†é 
        function updatePagination() {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            const pagination = document.getElementById('pagination');
            const paginationBottom = document.getElementById('paginationBottom');
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                paginationBottom.style.display = 'none';
                return;
            }
            
            const paginationHTML = createPaginationHTML(totalPages);
            pagination.innerHTML = paginationHTML;
            paginationBottom.innerHTML = paginationHTML;
            pagination.style.display = 'flex';
            paginationBottom.style.display = 'flex';
        }

        function createPaginationHTML(totalPages) {
            let html = `<button class="page-btn" onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>â€¹</button>`;
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</button>`;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    html += `<span class="page-btn">...</span>`;
                }
            }
            
            html += `<button class="page-btn" onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>â€º</button>`;
            return html;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredPlayers.length / playersPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                displayPlayers();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // æ¸…é™¤ç¯©é¸
        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('teamFilter').value = '';
            document.getElementById('rankFilter').value = '';
            applyFilters();
        }

        // ç…§ç‰‡æ¸¬è©¦åŠŸèƒ½
        function testPhotos() {
            const testPlayers = [
                "Nikola Jokic", "Luka Doncic", "Shai Gilgeous-Alexander", 
                "Giannis Antetokounmpo", "Joel Embiid", "Jayson Tatum",
                "Anthony Edwards", "Jalen Brunson", "Anthony Davis", "Victor Wembanyama"
            ];
            
            const results = [];
            let checkedCount = 0;
            
            // å‰µå»ºæ¸¬è©¦çª—å£
            const testWindow = document.createElement('div');
            testWindow.style.cssText = `
                position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: white; padding: 30px; border-radius: 15px; 
                box-shadow: 0 20px 40px rgba(0,0,0,0.3); z-index: 1000;
                max-width: 600px; max-height: 80vh; overflow-y: auto;
            `;
            
            testWindow.innerHTML = `
                <h3>ğŸ“¸ ç…§ç‰‡è¼‰å…¥æ¸¬è©¦</h3>
                <p>æ­£åœ¨æª¢æŸ¥å‰10åçƒå“¡çš„ç…§ç‰‡...</p>
                <div id="testResults" style="margin: 20px 0;"></div>
                <div style="text-align: center;">
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                        é—œé–‰
                    </button>
                </div>
            `;
            
            document.body.appendChild(testWindow);
            
            const resultsDiv = document.getElementById('testResults');
            
            testPlayers.forEach((playerName, index) => {
                const photoUrl = getPlayerPhotoUrl(playerName);
                const img = new Image();
                
                img.onload = function() {
                    results.push(`âœ… ${playerName}: ${photoUrl}`);
                    checkedCount++;
                    updateTestResults();
                };
                
                img.onerror = function() {
                    results.push(`âŒ ${playerName}: ${photoUrl} (æ–‡ä»¶ä¸å­˜åœ¨)`);
                    checkedCount++;
                    updateTestResults();
                };
                
                if (photoUrl) {
                    img.src = photoUrl;
                } else {
                    results.push(`âš ï¸ ${playerName}: ç„¡ç…§ç‰‡æ˜ å°„`);
                    checkedCount++;
                    updateTestResults();
                }
            });
            
            function updateTestResults() {
                resultsDiv.innerHTML = `
                    <div style="margin-bottom: 15px;">
                        <strong>é€²åº¦: ${checkedCount}/${testPlayers.length}</strong>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 14px;">
                        ${results.join('<br>')}
                    </div>
                    ${checkedCount === testPlayers.length ? `
                        <div style="margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 8px;">
                            <h4>ğŸ’¡ è§£æ±ºå»ºè­°ï¼š</h4>
                            <ol style="text-align: left; margin: 10px 0;">
                                <li><strong>æª¢æŸ¥æ–‡ä»¶ä½ç½®ï¼š</strong>ç¢ºä¿photosæ–‡ä»¶å¤¾èˆ‡HTMLæ–‡ä»¶åœ¨åŒä¸€ç›®éŒ„</li>
                                <li><strong>æª¢æŸ¥æ–‡ä»¶åï¼š</strong>ç¢ºä¿ç…§ç‰‡æ–‡ä»¶åèˆ‡ä¸Šè¿°é¡¯ç¤ºçš„å®Œå…¨åŒ¹é…</li>
                                <li><strong>ä½¿ç”¨æœ¬åœ°æœå‹™å™¨ï¼š</strong>å»ºè­°ä½¿ç”¨Live Serveræˆ–é¡ä¼¼å·¥å…·é‹è¡Œ</li>
                                <li><strong>ä¸Šå‚³æ–‡ä»¶ï¼š</strong>å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–‡ä»¶é¸æ“‡å™¨ç›´æ¥é¸æ“‡ç…§ç‰‡</li>
                            </ol>
                        </div>
                    ` : ''}
                `;
            }
        }

        // æ–‡ä»¶ä¸Šå‚³è™•ç†åŠŸèƒ½
        function setupFileUpload() {
            const uploadDiv = document.createElement('div');
            uploadDiv.innerHTML = `
                <div style="margin: 20px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; text-align: center;">
                    <h4>ğŸ“ ç›´æ¥é¸æ“‡çƒå“¡ç…§ç‰‡</h4>
                    <input type="file" id="photoUpload" multiple accept="image/*" 
                           style="margin: 10px 0; padding: 10px; border: 2px dashed #ccc; border-radius: 5px;">
                    <p style="font-size: 0.9em; color: #666;">
                        é¸æ“‡å¤šå¼µçƒå“¡ç…§ç‰‡ï¼Œç³»çµ±æœƒè‡ªå‹•å˜—è©¦åŒ¹é…çƒå“¡å§“å
                    </p>
                </div>
            `;
            
            document.querySelector('.container').insertBefore(uploadDiv, document.getElementById('statsSummary'));
            
            document.getElementById('photoUpload').addEventListener('change', handleFileUpload);
        }

        // è™•ç†æ–‡ä»¶ä¸Šå‚³
        function handleFileUpload(event) {
            const files = event.target.files;
            const uploadedPhotos = {};
            
            for (let file of files) {
                const fileName = file.name.toLowerCase().replace(/\.(jpg|jpeg|png)$/, '');
                const fileUrl = URL.createObjectURL(file);
                
                // å˜—è©¦åŒ¹é…çƒå“¡åç¨±
                for (let playerName of top100Players) {
                    const normalizedPlayerName = playerName.toLowerCase()
                        .replace(/[^a-z\s]/g, '')
                        .replace(/\s+/g, '-');
                    
                    if (fileName.includes(normalizedPlayerName) || 
                        normalizedPlayerName.includes(fileName)) {
                        uploadedPhotos[playerName] = fileUrl;
                        console.log(`ğŸ¯ åŒ¹é…æˆåŠŸ: ${playerName} -> ${file.name}`);
                        break;
                    }
                }
            }
            
            // æ›´æ–°ç…§ç‰‡æ˜ å°„ä¸¦é‡æ–°é¡¯ç¤º
            Object.assign(window.uploadedPhotos = window.uploadedPhotos || {}, uploadedPhotos);
            
            if (Object.keys(uploadedPhotos).length > 0) {
                displayPlayers(); // é‡æ–°é¡¯ç¤ºçƒå“¡å¡ç‰‡
                
                alert(`æˆåŠŸè¼‰å…¥ ${Object.keys(uploadedPhotos).length} å¼µçƒå“¡ç…§ç‰‡ï¼\n\nåŒ¹é…çš„çƒå“¡ï¼š\n${Object.keys(uploadedPhotos).join('\n')}`);
            } else {
                alert('æœªèƒ½è‡ªå‹•åŒ¹é…ä»»ä½•çƒå“¡ç…§ç‰‡ã€‚\nè«‹ç¢ºä¿æ–‡ä»¶ååŒ…å«çƒå“¡å§“åã€‚');
            }
        }

        // ä¿®æ”¹ç…§ç‰‡ç²å–å‡½æ•¸ä»¥æ”¯æŒä¸Šå‚³çš„ç…§ç‰‡
        function getPlayerPhotoUrl(playerName) {
            // å„ªå…ˆä½¿ç”¨ä¸Šå‚³çš„ç…§ç‰‡
            if (window.uploadedPhotos && window.uploadedPhotos[playerName]) {
                return window.uploadedPhotos[playerName];
            }
            
            // ç„¶å¾Œä½¿ç”¨é è¨­çš„ç…§ç‰‡æ˜ å°„
            if (playerPhotoMappings[playerName]) {
                return playerPhotoMappings[playerName];
            }
            
            // æœ€å¾Œå˜—è©¦è‡ªå‹•ç”Ÿæˆè·¯å¾‘
            try {
                const formattedName = playerName.toLowerCase()
                    .replace(/[^a-z\s]/g, '')
                    .replace(/\s+/g, '-');
                
                return `photos/${formattedName}.jpg`;
            } catch (error) {
                return null;
            }
        }

        // äº‹ä»¶ç›£è½å™¨
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('teamFilter').addEventListener('change', applyFilters);
        document.getElementById('rankFilter').addEventListener('change', applyFilters);
        document.getElementById('dataTypeSelect').addEventListener('change', loadPlayers);
    </script>
</body>
</html>